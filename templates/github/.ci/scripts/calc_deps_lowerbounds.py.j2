{% include 'header.j2' %}

from packaging.requirements import Requirement


def main():
    """Calculate constraints for the lower bound of dependencies where possible."""
    with open("requirements.txt") as req_file:
        for line in req_file:
            split_line = line.split("#", maxsplit=1)
            try:
                comment = "  # " + split_line[1].strip()
            except IndexError:
                comment = ""
            try:
                requirement = Requirement(split_line[0])
            except ValueError:
                print(f"# {line.strip()}")
            else:
                for spec in requirement.specifier:
                    if spec.operator == ">=":
                        if requirement.name == "pulpcore":
                            operator = "~="
                        else:
                            operator = "=="
                        min_version = str(spec)[2:]
                        print(f"{requirement.name}{operator}{min_version}{comment}")
                        break
                else:
                    print(f"# {line.strip()}")


if __name__ == "__main__":
    main()
