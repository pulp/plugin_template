#!/bin/bash

{% include 'header.j2' %}

# make sure this script runs at the repo root
cd "$(dirname "$(realpath -e "$0")")"/../..

set -eu

if [ $# -eq 0 ]; then
  echo "Usage: $0 <filename> [filename ...]"
  exit 1
fi

# check for imports not from pulpcore.plugin. exclude tests
if MATCHES=$(
  grep -n "from pulpcore.*import" "$@" |
  grep -v "tests\|plugin" {%- for allow in core_import_allowed %} |
  grep -v "{{allow}}" {%- endfor %}
); then
  echo "ERROR: Detected bad imports. Plugins should import from 'pulpcore.plugin':"
  echo "$MATCHES"
  exit 1
fi
